{% extends 'auctions/layout.html' %} {% block body %}
  {% load my_tags %}

  <h2>Listing: {{ listing.title }}</h2>
  <div class="row">
    <div class="col-lg">
      <img src="{{ listing.imgUrl }}" class="w-50 p-3" />
    </div>
    <div class="col-lg">
      <div>{{ listing.description }}</div>
      <h3>${{ highestBid }}</h3>

      {% if user.is_authenticated and listing.closed == False and user.username != listing.owner %}
        <form action="{% url 'change_watchlist' listing.id %}" method="post">
          {% csrf_token %}
          <button class="btn btn-primary" type="submit">
            {% if user.username|is_in_list:listing.watchers.all %}
              Remove from Watchlist
            {% else %}
              Add to Watchlist
            {% endif %}
          </button>
        </form>
        <form action="{% url 'bid' listing.id %}" method="post">
          {% csrf_token %}
          <div class="form-group">
            <input name="bid" type="number" step="0.01" value="{{ highestBid }}" min="{{ highestBid }}" />
          </div>
          <button class="btn btn-primary" type="submit">Bid</button>
        </form>
      {% endif %}
    </div>
  </div>

  <h4>Details</h4>
  <ul>
    <li>Listed by:{{ listing.owner }}</li>
    <li>Category:{{ listing.category }}</li>
    <li>Closed:{{ listing.closed }}</li>
    <li>Watchers:{{ listing.watchers.all.count }}</li>
    <li>Bids:{{ bids }}</li>
  </ul>

  {% if user.username == listing.owner %}
    <form action="{% url 'close' listing.id %}" method="post">
      {% csrf_token %}
      <button class="btn btn-danger">Close Auction</button>
    </form>
  {% endif %}

  {% for comment in comments %}
    <div>{{ comment }}</div>
  {% endfor %}
  <form action="{% url 'comment' listing.id %}" method="post">
    {% csrf_token %}
    <div class="form-group">
      <input name="comment" type="text" placeholder="Enter Comment" />
    </div>
    <button class="btn btn-primary" type="submit">Post</button>
  </form>
{% endblock %}
